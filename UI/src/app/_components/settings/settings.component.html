<div class="container pt-4" *ngIf="initialDataLoaded">
  <div class="row">
    <h2>
      Sources
      <button class="btn btn-outline-success me-2" (click)="addSource(sourceModal)">
        <i class="fas fa-plus"></i> Add 
      </button>
      <button class="btn btn-outline-dark" (click)="toggleTestMode()">
        <i class="fas fa-vial"></i> Turn {{ testModeOn ? "Off" : "On" }} Test Mode
      </button>
    </h2>
    <span class="text-muted mt-3" *ngIf="sources.length == 0">No sources configured.</span>
    <table class="table table-hover" *ngIf="sources.length > 0">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let source of sources" [class]="
            source.enabled
              ? source.connected
                ? 'text-success'
                : 'text-danger'
              : 'text-muted'
          ">
          <td>{{ source.name }}</td>
          <td>{{ source.sourceTypeName }}</td>
          <td>
            <button class="btn btn-outline-dark" (click)="editSource(source, sourceModal)">
              <i class="fas fa-pen"></i> Edit
            </button>
            <button class="btn btn-outline-danger mx-2" (click)="deleteSource(source)">
              <i class="fas fa-trash"></i> Delete
            </button>
            <button class="btn btn-outline-dark" *ngIf="!source.connected" (click)="reconnect(source)">
              <i class="fas fa-sync"></i> Reconnect
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <hr class="my-5" />
  <div class="row">
    <h2>
      Devices
      <button class="btn btn-outline-success" (click)="addDevice(deviceModal)"><i class="fas fa-plus"></i> Add </button>
    </h2>
    <span class="text-muted mt-3" *ngIf="devices.length == 0">No devices configured.</span>
    <table class="table table-hover" *ngIf="devices.length > 0">
      <thead>
        <tr>
          <th>PVW</th>
          <th>PGM</th>
          <th>Name</th>
          <th>Description</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let device of devices; index as index" [class.text-muted]="!device.enabled">
          <td [class.bg-success]="device.modePreview"></td>
          <td [class.bg-danger]="device.modeProgram"></td>
          <td>
            <small><b>{{ index + 1 }}</b></small>
            {{ device.name }}
          </td>
          <td>{{ device.description }}</td>
          <td>
            <button class="btn btn-outline-dark me-2" (click)="editDevice(device, deviceModal)">
              <i class="fas fa-pen"></i> Edit
            </button>
            <button class="btn btn-outline-dark me-2" (click)="editDeviceSources(device, deviceSourcesModal)"><i class="fas fa-link"></i> Edit Sources ({{getDeviceSourcesByDeviceId(device.id).length}})</button>
            <button class="btn btn-outline-dark me-2" (click)="editDeviceActions(device, deviceActionsModal)"><i class="fas fa-play"></i> Edit Actions ({{getDeviceActionsByDeviceId(device.id).length}})</button>
            <button class="btn btn-outline-danger" (click)="deleteDevice(device)"><i class="fas fa-trash"></i> Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <hr class="my-5" />
  <div class="row">
    <h2>Connected Listeners</h2>
    <span class="text-muted mt-3" *ngIf="listenerClients.length == 0">No listeners connected.</span>
    <table class="table table-hover" *ngIf="listenerClients.length > 0">
      <thead>
        <tr>
          <th>IP Address</th>
          <th class="bg-light">Type</th>
          <th>Device</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let listenerClient of listenerClients">
          <td>{{ listenerClient.ipAddress }}</td>
          <td class="bg-light">{{ listenerClient.listenerType }}</td>
          <td>
            <select class="form-select" [ngModel]="listenerClient.deviceId" (ngModelChange)="reassignListenerClient(listenerClient, $event)"
              [disabled]="!listenerClient.canBeReassigned">
              <option *ngFor="let device of devices" [value]="device.id">
                {{ device.name }}
              </option>
            </select>
          </td>
          <td>
            <button class="btn btn-outline-danger me-2" *ngIf="listenerClient.inactive" (click)="deleteListener(listenerClient)">
                <i class="fas fa-trash"></i> Delete
            </button>
            <button class="btn btn-outline-dark" *ngIf="!listenerClient.inactive && listenerClient.canBeFlashed"
              (click)="flash(listenerClient)">
              <i class="fas fa-exclamation"></i> Flash
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <hr class="my-5" />
  <div class="row">
    <h2>TSL Clients
      <button class="btn btn-outline-success mr-1" (click)="addTSLClient(tslClientModal)"><i class="fas fa-plus"></i> Add</button>
    </h2>
    <div>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="chkTSLClients_1SecUpdate" [(ngModel)]="tslclients_1secupdate" (ngModelChange)="socket.emit('tslclients_1secupdate', $event);">
        <label class="form-check-label" for="chkTSLClients_1SecUpdate">1-Second Updates</label>
      </div>
      <span class="text-muted mt-3 d-block" *ngIf="tslClients.length == 0">No TSL clients configured.</span>
      <table class="table table-hover" *ngIf="tslClients.length > 0">
          <thead>
              <tr>
                  <th>IP</th>
                  <th>Port</th>
                  <th>Transport</th>
                  <th></th>
              </tr>
          </thead>
          <tbody>
              <tr *ngFor="let tslClient of tslClients" [class.text-success]="tslClient.connected">
                <td>{{tslClient.ip}}</td>
                <td>{{tslClient.port}}</td>
                <td>{{tslClient.transport}}</td>
                <td>
                    <button class="btn btn-outline-dark" (click)="editTSLClient(tslClient, tslClientModal)">
                        <i class="fas fa-pen"></i> Edit
                    </button>
                    <button class="btn btn-outline-danger mx-2" (click)="deleteTSLClient(tslClient)">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
              </tr>
          </tbody>
      </table>
    </div>
  </div>
  <hr class="my-5" />
  <div class="row">
      <div class="mb-3">
          <h2><i class="fas fa-cloud text-muted"></i> Cloud Settings</h2>
        </div>
        <div class="col">
            <h4>
                Destinations
                <button class="btn btn-outline-success" (click)="addCloudDestination(cloudDestinationModal)"><i class="fas fa-plus"></i> Add </button>
            </h4>
            <span class="text-muted mt-3" *ngIf="cloudDestinations.length == 0">No cloud destinations configured.</span>
            <table class="table table-hover" *ngIf="cloudDestinations.length > 0">
                <thead>
                    <tr>
                        <th>Host</th>
                        <th>Port</th>
                        <th>Key</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let cloudDestination of cloudDestinations" [class.text-success]="cloudDestination.status == 'connected'">
                        <td>{{cloudDestination.host}}</td>
                        <td>{{cloudDestination.port}}</td>
                        <td>{{cloudDestination.key}}</td>
                        <td><span *ngIf="cloudDestination.status == 'invalid_key'" class="text-danger">Invalid Key!</span></td>
                        <td>
                            <button class="btn btn-outline-dark" (click)="editCloudDestination(cloudDestination, cloudDestinationModal)">
                                <i class="fas fa-pen"></i> Edit
                            </button>
                            <button class="btn btn-outline-danger mx-2" (click)="deleteCloudDestination(cloudDestination)">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <button class="btn btn-outline-dark" *ngIf="cloudDestination.status == 'disconnected'" (click)="reconnectCloudDestination(cloudDestination)">
                                <i class="fas fa-sync"></i> Reconnect
                            </button>
                            <button class="btn btn-outline-dark" *ngIf="cloudDestination.status == 'connected'" (click)="disconnectCloudDestination(cloudDestination)">
                                <i class="fas fa-times"></i> Disconnect
                            </button>

                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col">
            <h4>
                Keys
                <button class="btn btn-outline-success" (click)="addCloudKey(cloudKeyModal)"><i class="fas fa-plus"></i> Add </button>
            </h4>
            <span class="text-muted mt-3" *ngIf="cloudKeys.length == 0">No cloud keys configured.</span>
            <table class="table table-hover" *ngIf="cloudKeys.length > 0">
                <thead>
                    <tr>
                        <th>Key</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let key of cloudKeys">
                        <td>{{key}}</td>
                        <td>
                            <button class="btn btn-outline-danger" (click)="deleteCloudKey(key)"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
  </div>
  <div class="row mt-4">
        <div class="col">
            <h4>Clients</h4>
            <span class="text-muted mt-3" *ngIf="cloudClients.length == 0">No cloud clients connected.</span>
            <table class="table table-hover" *ngIf="cloudClients.length > 0">
                <thead>
                    <tr>
                        <th>IP</th>
                        <th>Key</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let client of cloudClients">
                        <td>{{client.ipAddress.replace("::ffff:", "")}}</td>
                        <td>{{client.key}}</td>
                        <td>
                            <button class="btn btn-outline-danger" (click)="removeCloudClient(client)"><i class="fas fa-trash"></i> Remove</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
  </div>
  <hr class="my-5" />
  <div class="row">
    <div class="col-xs-12 col-md-6" id="divContainer_Logs">
      <h2>Logs</h2>
      <div class="logs bg-light p-1" #logsContainer>
        <span class="d-block" [style.color]="
            log.type == 'console_action'
              ? '#00ff00'
              : log.type == 'error'
              ? '#FF0000'
              : '#0000FF'
          " *ngFor="let log of logs">[{{ log.datetime | date: "shortDate" }}
          {{ log.datetime | date: "shortTime" }}] {{ log.log }}</span>
      </div>
    </div>
    <div class="col-xs-12 col-md-6" id="divContainer_TallyData">
      <h2>Tally Data</h2>
      <div class="logs bg-light p-1" #tallyDataContainer>
        <span class="d-block" *ngFor="let log of tallyData">[{{ log.datetime | date: "shortDate" }}
          {{ log.datetime | date: "shortTime" }}] {{ log.log }}</span>
      </div>
    </div>
  </div>
  <div class="text-muted my-3">Version {{ version }}</div>
</div>
<div *ngIf="!initialDataLoaded" class="d-flex justify-content-center mt-5 pt-5">
    <div class="spinner spinner-border text-dark"></div>
</div>

<ng-template #sourceModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      {{ editingSource ? "Edit" : "Add" }} Source
    </h4>
    <button class="btn" (click)="modal.dismiss()"><span>&times;</span></button>
  </div>
  <div class="modal-body">
    <ng-container *ngIf="editingSource">
      <div class="mb-3">
        <label for="sourceId" class="form-label">Source Id</label>
        <input type="text" id="sourceId" class="form-control" disabled [ngModel]="currentSource.id" />
      </div>
      <div class="mb-3">
        <label for="sourceType" class="form-label">Source Type</label>
        <select id="sourceType" class="form-select" disabled>
          <option>
            {{ sourceTypes[currentSourceSelectedTypeIdx!].label }}
          </option>
        </select>
      </div>
    </ng-container>
    <ng-container *ngIf="!editingSource">
      <select class="form-select" ngbAutofocus [(ngModel)]="currentSourceSelectedTypeIdx">
        <option selected disabled [value]="undefined">-- Choose Source Type --</option>
        <option *ngFor="
            let sourceType of filterEnabledSourceTypes(sourceTypes);
            index as index
          " [value]="index">
          {{ sourceType.label }}
        </option>
      </select>
    </ng-container>
    <div *ngIf="currentSourceSelectedTypeIdx !== undefined">
      <p>{{ sourceTypes[currentSourceSelectedTypeIdx].help }}</p>
      <div class="mb-3">
        <label for="sourceName" class="form-label">Source Name</label>
        <input type="text" class="form-control" id="sourceName" [(ngModel)]="currentSource.name" />
      </div>
      <ng-container *ngFor="
          let field of getOptionFields(
            sourceTypes[currentSourceSelectedTypeIdx]
          )
        ">
        <ng-container [ngSwitch]="field.fieldType">
          <div class="mb-3" *ngSwitchCase="'text'">
            <label [for]="field.fieldName" class="form-label">{{
              field.fieldLabel
            }}</label>
            <input type="text" class="form-control" [id]="field.fieldName"
              [(ngModel)]="currentSource.data[field.fieldName]" />
          </div>
          <div class="mb-3" *ngSwitchCase="
              ['port', 'number'].includes(field.fieldType)
                ? field.fieldType
                : ''
            ">
            <label [for]="field.fieldName" class="form-label">{{
              field.fieldLabel
            }}</label>
            <input type="number" class="form-control" [id]="field.fieldName"
              [(ngModel)]="currentSource.data[field.fieldName]" />
          </div>
          <div class="mb-3" *ngSwitchCase="'multiselect'">
            <label [for]="field.fieldName" class="form-label">{{
              field.fieldLabel
            }}</label>
            <select class="form-select" multiple [id]="field.fieldName"
              [(ngModel)]="currentSource.data[field.fieldName]">
              <option *ngFor="let option of field.options" [value]="option.id">
                {{ option.label }}
              </option>
            </select>
            <small class="form-text">Use Ctrl to select multiple items.</small>
          </div>
          <div class="mb-3" *ngSwitchCase="'dropdown'">
            <label [for]="field.fieldName" class="form-label">{{
              field.fieldLabel
            }}</label>
            <select class="form-select" [id]="field.fieldName" [(ngModel)]="currentSource.data[field.fieldName]">
              <option *ngFor="let option of field.options" [value]="option.id">
                {{ option.label }}
              </option>
            </select>
          </div>
          <div class="mb-3" *ngSwitchCase="'info'">
            <label class="form-label">{{ field.fieldLabel }}</label><br />
            <small class="form-text">{{ field.text }}</small>
          </div>
        </ng-container>
      </ng-container>
      <ng-container *ngIf="editingSource">
        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" id="enabled" [(ngModel)]="currentSource.enabled" />
          <label class="form-check-label" for="enabled">Enabled</label>
        </div>
        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" id="reconnect" [(ngModel)]="currentSource.reconnect" />
          <label class="form-check-label" for="reconnect">Reconnect</label>
        </div>
      </ng-container>
      <div class="d-flex justify-content-end">
        <button class="btn btn-outline-dark" (click)="saveCurrentSource()">
          <i class="fas fa-save"></i> {{ editingSource ? "Save Changes" : "Add Source" }}
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #deviceModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      {{ editingSource ? "Edit" : "Add" }} Device
    </h4>
    <button class="btn" (click)="modal.dismiss()"><span>&times;</span></button>
  </div>
  <div class="modal-body">
    <ng-container *ngIf="editingDevice">
      <div class="mb-3">
        <label for="deviceId" class="form-label">Device Id</label>
        <input type="text" id="sourceId" class="form-control" disabled [ngModel]="currentDevice.id" />
      </div>
    </ng-container>

    <div class="mb-3">
      <label for="deviceName" class="form-label">Device Name</label>
      <input type="text" class="form-control" id="deviceName" [(ngModel)]="currentDevice.name" />
    </div>
    <div class="mb-3">
      <label for="deviceDescription" class="form-label">Device Description</label>
      <input type="text" class="form-control" id="deviceDescription" [(ngModel)]="currentDevice.description" />
    </div>
    <ng-container *ngIf="editingDevice">
      <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="enabled" [(ngModel)]="currentDevice.enabled" />
        <label class="form-check-label" for="enabled">Enabled</label>
      </div>
    </ng-container>
    <div class="d-flex justify-content-end">
      <button class="btn btn-outline-dark" (click)="saveCurrentDevice()">
        <i class="fas fa-save"></i> {{ editingDevice ? "Save Changes" : "Add Device" }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #deviceSourcesModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      Device Sources: {{currentDevice.name}}
    </h4>
    <button class="btn" (click)="modal.dismiss()"><span>&times;</span></button>
  </div>
  <div class="modal-body">
    <div *ngIf="!editingDeviceSource">
      <b>Device Source Linking - Preview Bus:</b>
      <div class="form-check">
        <input type="radio" class="form-check-input" id="rdoDeviceSourcesPVWUnlinked" name="deviceSourcePVWLinking" [(ngModel)]="currentDevice.linkedPreview" [value]="false" (ngModelChange)="updateDeviceSourceLink('preview', $event)">
        <label class="form-check-label" for="rdoDeviceSourcesPVWUnlinked">Unlinked: The device can be in PVW if it is in PVW in <b>any</b> Device Source (default)</label>
      </div>
      <div class="form-check">
        <input type="radio" class="form-check-input" id="rdoDeviceSourcesPVWLinked" name="deviceSourcePVWLinking" [(ngModel)]="currentDevice.linkedPreview" [value]="true" (ngModelChange)="updateDeviceSourceLink('preview', $event)">
        <label class="form-check-label" for="rdoDeviceSourcesPVWLinked">Linked: The device is only considered to be in PVW if it is in PVW across <b>all</b> Device Sources.</label>
      </div>
      <br />
      <b>Device Source Linking - Program Bus:</b>
      <div class="form-check">
        <input type="radio" class="form-check-input" id="rdoDeviceSourcesPGMUnlinked" name="deviceSourcePGMLinking" [(ngModel)]="currentDevice.linkedProgram" [value]="false" (ngModelChange)="updateDeviceSourceLink('program', $event)">
        <label class="form-check-label" for="rdoDeviceSourcesPGMUnlinked">Unlinked: The device can be in PGM if it is in PGM in <b>any</b> Device Source (default)</label>
      </div>
      <div class="form-check">
        <input type="radio" class="form-check-input" id="rdoDeviceSourcesPGMLinked" name="deviceSourcePGMLinking" [(ngModel)]="currentDevice.linkedProgram" [value]="true" (ngModelChange)="updateDeviceSourceLink('program', $event)">
        <label class="form-check-label" for="rdoDeviceSourcesPGMLinked">Linked: The device is only considered to be in PGM if it is in PGM across <b>all</b> Device Sources.</label>
      </div>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Source</th>
            <th>Address</th>
            <th>(Bus)</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let deviceSource of getDeviceSourcesByDeviceId(currentDevice.id)">
            <td>
              {{getSourceById(deviceSource.sourceId)?.name}}
            </td>
            <td>{{deviceSource.address}}</td>
            <td>{{deviceSource.bus}}</td>
            <td>
              <button class="btn btn-outline-dark me-1" (click)="editDeviceSource(deviceSource)"><i class="fas fa-pen"></i> Edit</button>
              <button class="btn btn-outline-danger" (click)="deleteDeviceSource(deviceSource)"><i class="fas fa-trash"></i> Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-outline-success mr-1" (click)="editingDeviceSource = true"><i class="fas fa-plus"></i> Add Source</button>
    </div>
    <div *ngIf="editingDeviceSource">
      <h5>New Device Source</h5>
      <div class="mb-3">
        <label for="deviceSource" class="form-label">Source</label>
        <select class="form-select" [(ngModel)]="currentDeviceSource.sourceIdx"
          (ngModelChange)="socket.emit('source_tallydata', sources[$event].id)">
          <option *ngFor="let source of sources; index as index" [value]="index">{{source.name}}</option>
        </select>
      </div>
      <div class="mb-3" *ngIf="sources[currentDeviceSource.sourceIdx!]">
        <label for="deviceSource" class="form-label">Address
          ({{sourceTallyData[sources[currentDeviceSource.sourceIdx!].id] && sourceTallyData[sources[currentDeviceSource.sourceIdx!].id].length > 0 ? 'select or ' : ''}}enter
          manually):</label>
        <div class="row">
          <div class="col"
            *ngIf="sourceTallyData[sources[currentDeviceSource.sourceIdx!].id] && sourceTallyData[sources[currentDeviceSource.sourceIdx!].id].length > 0">
            <select class="form-select" [(ngModel)]="currentDeviceSource.address">
              <option *ngFor="let address of sourceTallyData[sources[currentDeviceSource.sourceIdx!].id]"
                [value]="address.address">{{address.label}}</option>
            </select>
          </div>
          <div class="col">
            <input type="text" class="form-control" [(ngModel)]="currentDeviceSource.address" placeholder="Address">
          </div>
        </div>
      </div>
      <div class="mb-3"
        *ngIf="sources[currentDeviceSource.sourceIdx!] && getSourceBusOptionsBySourceTypeId(sources[currentDeviceSource.sourceIdx!].sourceTypeId).length > 0">
        <label for="bus" class="form-label">Bus:</label>
        <select class="form-select" [(ngModel)]="currentDeviceSource.bus">
          <option
            *ngFor="let bus of getSourceBusOptionsBySourceTypeId(sources[currentDeviceSource.sourceIdx!].sourceTypeId)[0].busses"
            [value]="bus.bus">{{bus.name}}</option>
        </select>
      </div>
      <div class="d-flex justify-content-end">
        <button class="btn btn-outline-dark" (click)="saveDeviceSource()"><i class="fas fa-save"></i> {{currentDeviceSource.id !== undefined ? 'Save Changes' : 'Add Device Source'}}</button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #deviceActionsModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">
        Device Actions: {{currentDevice.name}}
        </h4>
        <button class="btn" (click)="modal.dismiss()"><span>&times;</span></button>
    </div>
    <div class="modal-body">
        <div *ngIf="!editingDeviceAction">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>Bus</th>
                <th>On / Off</th>
                <th>Output Type</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let deviceAction of getDeviceActionsByDeviceId(currentDevice.id)">
                <td>{{getBusById(deviceAction.busId)?.label}}</td>
                <td>{{deviceAction.active ? 'On' : 'Off'}}</td>
                <td>{{getOutputTypeById(deviceAction.outputTypeId)?.label}}</td>
                <td>
                <button class="btn btn-outline-dark me-1" (click)="editDeviceAction(deviceAction)"><i class="fas fa-pen"></i> Edit</button>
                <button class="btn btn-outline-danger" (click)="deleteDeviceAction(deviceAction)"><i class="fas fa-trash"></i> Delete</button>
                </td>
            </tr>
            </tbody>
        </table>
        <button class="btn btn-outline-success mr-1" (click)="addDeviceAction()"><i class="fas fa-plus"></i> Add Action</button>
        </div>
        <div *ngIf="editingDeviceAction">
        <h5>New Device Action</h5>
        <div class="mb-3">
            <label for="bus" class="form-label">Bus</label>
            <select class="form-select" [(ngModel)]="currentDeviceAction.busId">
                <option disabled selected [value]="undefined">-- Select --</option>
                <option *ngFor="let bus of busOptions" [value]="bus.id">{{bus.label}}</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="bus" class="form-label">Active</label>
            <select class="form-select" [(ngModel)]="currentDeviceAction.active">
                <option disabled selected [value]="undefined">-- Select --</option>
                <option [value]="true">On</option>
                <option [value]="true">Off</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="outputType" class="form-label">Output Type</label>
            <select class="form-select" id="outputType" [(ngModel)]="currentDeviceAction.outputTypeIdx">
                <option disabled selected [value]="undefined">-- Select --</option>
                <option *ngFor="let outputType of outputTypes; index as index" [value]="index">{{outputType.label}}</option>
            </select>
        </div>
        
        <ng-container *ngIf="outputTypes[currentDeviceAction.outputTypeIdx!]">

            <ng-container *ngFor="let field of getOutputOptionFields(outputTypes[currentDeviceAction.outputTypeIdx!])">
                <ng-container [ngSwitch]="field.fieldType">
                    <div class="mb-3" *ngSwitchCase="'text'">
                        <label [for]="field.fieldName" class="form-label">{{field.fieldLabel}}</label>
                        <input type="text" class="form-control" [id]="field.fieldName" [(ngModel)]="currentDeviceAction.data[field.fieldName]" />
                    </div>
                    <div class="mb-3" *ngSwitchCase="['port', 'number'].includes(field.fieldType) ? field.fieldType : ''">
                        <label [for]="field.fieldName" class="form-label">{{field.fieldLabel}}</label>
                        <input type="number" class="form-control" [id]="field.fieldName" [(ngModel)]="currentDeviceAction.data[field.fieldName]" />
                    </div>
                    <div class="mb-3" *ngSwitchCase="'dropdown'">
                        <label [for]="field.fieldName" class="form-label">{{
                            field.fieldLabel
                        }}</label>
                        <select class="form-select" [id]="field.fieldName" [(ngModel)]="currentDeviceAction.data[field.fieldName]">
                            <option disabled selected [value]="undefined">-- Select --</option>
                            <option *ngFor="let option of field.options" [value]="option.id">
                                {{ option.label }}
                            </option>
                        </select>
                    </div>
                    <div class="mb-3 form-check" *ngSwitchCase="'bool'">
                        <input class="form-check-input" type="checkbox" [id]="field.fieldName" [(ngModel)]="currentDeviceAction.data[field.fieldName]">
                        <label [for]="field.fieldName" class="form-check-label">{{field.fieldLabel}}</label>
                    </div>
                </ng-container>
            </ng-container>
        </ng-container>
            
            <div class="d-flex justify-content-end">
                <button class="btn btn-outline-dark" (click)="saveDeviceAction()"><i class="fas fa-save"></i> {{currentDeviceAction.id !== undefined ? 'Save Changes' : 'Add Action'}}</button>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #tslClientModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">
        {{ editingSource ? "Edit" : "Add" }} TSL Client
      </h4>
      <button class="btn" (click)="modal.dismiss()"><span>&times;</span></button>
    </div>
    <div class="modal-body">
      <ng-container *ngIf="editingTSLClient">
        <div class="mb-3">
          <label for="tslClientId" class="form-label">TSL Client Id</label>
          <input type="text" id="tslClientId" class="form-control" disabled [ngModel]="currentTSLClient.id" />
        </div>
      </ng-container>
  
      <div class="mb-3">
        <label for="tslIP" class="form-label">IP address</label>
        <input type="text" class="form-control" id="tslIP" [(ngModel)]="currentTSLClient.ip" />
      </div>
      <div class="mb-3">
        <label for="tslPort" class="form-label">Port</label>
        <input type="number" class="form-control" id="tslPort" [(ngModel)]="currentTSLClient.port" />
      </div>
      <div class="mb-3">
        <label for="tslTransport" class="form-label">Transport</label>
        <select class="form-select" id="tslTransport" [(ngModel)]="currentTSLClient.transport">
            <option value="tcp">TCP</option>
            <option value="udp">UDP</option>
        </select>
      </div>
      <div class="d-flex justify-content-end">
        <button class="btn btn-outline-dark" (click)="saveCurrentTSLClient()">
          <i class="fas fa-save"></i> {{ editingTSLClient ? "Save Changes" : "Add TSL Client" }}
        </button>
      </div>
    </div>
  </ng-template>

<ng-template #cloudDestinationModal let-modal>
    <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
        {{ editingSource ? "Edit" : "Add" }} Cloud Destination
    </h4>
    <button class="btn" (click)="modal.dismiss()"><span>&times;</span></button>
    </div>
    <div class="modal-body">
    <ng-container *ngIf="editingCloudDestination">
        <div class="mb-3">
        <label for="cloudId" class="form-label">Cloud Destination Id</label>
        <input type="text" id="cloudId" class="form-control" disabled [ngModel]="currentCloudDestination.id" />
        </div>
    </ng-container>

    <div class="mb-3">
        <label for="cloudIP" class="form-label">Host</label>
        <input type="text" class="form-control" id="cloudHost" [(ngModel)]="currentCloudDestination.host" />
    </div>
    <div class="mb-3">
        <label for="cloudPort" class="form-label">Port</label>
        <input type="number" class="form-control" id="cloudPort" [(ngModel)]="currentCloudDestination.port" />
    </div>
    <div class="mb-3">
        <label for="cloudKey" class="form-label">Key</label>
        <input type="text" class="form-control" id="cloudKey" [(ngModel)]="currentCloudDestination.key" />
    </div>
    <div class="d-flex justify-content-end">
        <button class="btn btn-outline-dark" (click)="saveCurrentCloudDestination()">
        <i class="fas fa-save"></i> {{ editingCloudDestination ? "Save Changes" : "Add Cloud Destination" }}
        </button>
    </div>
    </div>
</ng-template>

<ng-template #cloudKeyModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Add Cloud Key</h4>
        <button class="btn" (click)="modal.dismiss()"><span>&times;</span></button>
    </div>
    <div class="modal-body">
        <div class="mb-3">
            <label for="key" class="form-label">Key</label>
            <input type="text" class="form-control" id="key" [(ngModel)]="newCloudKey" />
        </div>
        <div class="d-flex justify-content-end">
            <button class="btn btn-outline-dark" (click)="saveCloudKey()">
                <i class="fas fa-save"></i> Add Cloud Key
            </button>
        </div>
    </div>
</ng-template>